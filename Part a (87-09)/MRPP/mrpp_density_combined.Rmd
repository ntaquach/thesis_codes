---
title: "Density Combined MRPP"
author: "Anh"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.width=5, fig.height=5)
```

```{css, echo=FALSE}
h1, h4 {
  text-align: center;
  color: black;
  font-weight: bold;
}

/* Whole document: */
body{
  font-family: Times New Roman;
  font-size: 16pt;
}
/* Headers */
h1,h2,h3,h4,h5,h6{
  font-size: 24pt;
}


<style type="text/css">
body, td {
   font-size: 16px;
}
code.r{
  font-size: 16px;
}
pre {
  font-size: 16px
}
</style>
  
```

# Introduction

This document is written to perform the Multi-Response Permutation Procedure (MRPP). The purpose of doing MRPP on groups of stations: (1) upstream vs. downstream; (2) minimal development vs. intense development.

## Load packages

```{r warning=F, message=F}
library(vegan)
library(readxl)
```

## Load data

```{r warning=F, message=F}
getwd()
density_combined <- read_excel("density_combined.xlsx",
                        sheet = "Final")
```

## Relativize data

```{r warning=F, message=F}
density_wo_su <- density_combined[,2:ncol(density_combined)] #exclude the first column that contains SU information
density_wo_su_rel <- as.matrix(decostand(density_wo_su,method="total")) #calculate relative abundance from abundance data

rel_density <- data.frame(Site = density_combined$Site, density_wo_su_rel)

```

# Testing the difference among different sub-watersheds

## Create variable grouping

```{r message=F, warning=F}
library(dplyr)
rel_density <- as.data.frame(rel_density) %>%
  mutate(Group = case_when(
    Site %in% c("1_87", "2_87","3_87", "4_87","5_87", "7_87", "8_87",
                "9_87", "9a_87", "10_87") ~ "1987 Groups",  # Assign Group1 
    Site %in% c("1_09", "2_09", "3_09", "4_09","5_09", "7_09", "8_09",
                "9_09", "9a_09", "10_09") ~ "2009 Groups"  # Assign Group2
  )) %>% select(Site, Group, everything())

```

## Run MRPP

```{r message=F, warning=F}
# Run MRPP
result_mrpp <- mrpp(vegdist(rel_density[, -c(1, 2)], method="bray"), rel_density$Group, 
                    distance = "bray", permutations = 999)

# Print the results
print(result_mrpp)
```


# Testing the difference between 1987 and 2009 assemblages

## Create variable grouping

```{r message=F, warning=F}
library(dplyr)
rel_density <- as.data.frame(rel_density) %>%
  mutate(Group = case_when(
    Site %in% c("1_87", "2_87","3_87", "4_87","5_87", "7_87", "8_87",
                "9_87", "9a_87", "10_87") ~ "1987 Groups",  # Assign Group1 
    Site %in% c("1_09", "2_09", "3_09", "4_09","5_09", "7_09", "8_09",
                "9_09", "9a_09", "10_09") ~ "2009 Groups"  # Assign Group2
  )) %>% select(Site, Group, everything())

```

## Run MRPP

```{r message=F, warning=F}
# Run MRPP
result_mrpp <- mrpp(vegdist(rel_density[, -c(1, 2)], method="bray"), rel_density$Group, 
                    distance = "bray", permutations = 999)

# Print the results
print(result_mrpp)
```